{# Toast 通知組件 - Tailwind CSS 4.1 #}
<div id="toast-container" class="fixed top-4 right-4 z-50 space-y-2 pointer-events-none">
    <!-- Toast 訊息會動態插入這裡 -->
</div>

{# Tailwind JIT sentinel to保留暗色吐司用到的 class（避免被清除） #}
<div class="hidden">
    <div class="bg-slate-800/90 text-slate-50 border border-slate-600/70 rounded-xl shadow-2xl border-l-4
        border-green-400 border-red-400 border-yellow-300 border-blue-400
        bg-green-500/15 bg-red-500/15 bg-yellow-500/15 bg-blue-500/15
        text-green-200 text-red-200 text-yellow-200 text-blue-200">
    </div>
</div>

<script>
// Toast 通知系統
const ToastManager = {
    container: null,

    init() {
        this.container = document.getElementById('toast-container');
    },

    show(message, type = 'info', duration = 3000) {
        if (!this.container) this.init();

        const toast = this.createToast(message, type);
        this.container.appendChild(toast);

        // 觸發動畫
        setTimeout(() => {
            toast.classList.remove('translate-x-full', 'opacity-0');
        }, 10);

        // 自動關閉
        if (duration > 0) {
            setTimeout(() => {
                this.hide(toast);
            }, duration);
        }

        return toast;
    },

    createToast(message, type) {
        const toast = document.createElement('div');
        toast.className = `pointer-events-auto transform translate-x-full opacity-0 transition-all duration-300 ease-out
            flex items-start gap-3 bg-slate-800/90 text-slate-50 rounded-xl shadow-2xl p-4 min-w-[320px] max-w-md border border-slate-600/70 backdrop-blur`;

        // 根據類型設定顏色和圖標
        const config = {
            success: {
                borderClasses: ['border-l-4', 'border-green-400'],
                iconBg: 'bg-green-500/15',
                iconColor: 'text-green-200',
                icon: `<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                </svg>`
            },
            error: {
                borderClasses: ['border-l-4', 'border-red-400'],
                iconBg: 'bg-red-500/15',
                iconColor: 'text-red-200',
                icon: `<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                </svg>`
            },
            warning: {
                borderClasses: ['border-l-4', 'border-yellow-300'],
                iconBg: 'bg-yellow-500/15',
                iconColor: 'text-yellow-200',
                icon: `<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path>
                </svg>`
            },
            info: {
                borderClasses: ['border-l-4', 'border-blue-400'],
                iconBg: 'bg-blue-500/15',
                iconColor: 'text-blue-200',
                icon: `<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>`
            }
        };

        const style = config[type] || config.info;
        style.borderClasses.forEach((cls) => toast.classList.add(cls));

        toast.innerHTML = `
            <div class="flex-shrink-0 ${style.iconBg} ${style.iconColor} rounded-full p-2">
                ${style.icon}
            </div>
            <div class="flex-1 text-sm text-slate-50">
                ${message}
            </div>
            <button onclick="ToastManager.hide(this.closest('.transform'))"
                    class="flex-shrink-0 text-slate-400 hover:text-slate-200 transition">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                </svg>
            </button>
        `;

        return toast;
    },

    hide(toast) {
        toast.classList.add('translate-x-full', 'opacity-0');
        setTimeout(() => {
            toast.remove();
        }, 300);
    },

    success(message, duration) {
        return this.show(message, 'success', duration);
    },

    error(message, duration) {
        return this.show(message, 'error', duration);
    },

    warning(message, duration) {
        return this.show(message, 'warning', duration);
    },

    info(message, duration) {
        return this.show(message, 'info', duration);
    }
};

// 初始化
document.addEventListener('DOMContentLoaded', () => {
    ToastManager.init();
});

// 全域暴露
window.Toast = ToastManager;
</script>

{# 顯示 Flask Flash 訊息 #}
{% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
        <script>
        document.addEventListener('DOMContentLoaded', () => {
            {% for category, message in messages %}
                {# 映射 Flask 類別到 Toast 類型 #}
                {% if category == 'success' %}
                    Toast.success({{ message|tojson }});
                {% elif category == 'error' %}
                    Toast.error({{ message|tojson }});
                {% elif category == 'warning' %}
                    Toast.warning({{ message|tojson }});
                {% else %}
                    Toast.info({{ message|tojson }});
                {% endif %}
            {% endfor %}
        });
        </script>
    {% endif %}
{% endwith %}
