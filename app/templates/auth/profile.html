{% extends "base.html" %}
{% block title %}個人資料 - StudentTrade{% endblock %}

{% block content %}
<section class="py-10">
    <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 space-y-6">
        <!-- Profile Header -->
        <div class="bg-white rounded-xl shadow-card p-6">
            <h1 class="text-2xl font-semibold text-secondaryDark mb-2">個人資料</h1>
            <p class="text-secondary text-sm">管理您的個人資訊和帳戶設定</p>
        </div>

        <!-- Edit Profile Form -->
        <div class="bg-white rounded-xl shadow-card p-6">
            <h2 class="text-lg font-semibold text-secondaryDark mb-4">基本資料</h2>
            <form method="post" action="{{ url_for('auth.profile') }}" class="space-y-4">
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                <input type="hidden" name="action" value="update_profile">

                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="space-y-2">
                        <label class="text-sm font-medium text-secondaryDark">使用者名稱 *</label>
                        <input type="text" name="username" required value="{{ current_user.username }}"
                            class="w-full px-4 py-3 rounded-md border border-secondaryLight focus:ring-2 focus:ring-primary/60 focus:border-primary">
                    </div>

                    <div class="space-y-2">
                        <label class="text-sm font-medium text-secondaryDark">電子郵件 *</label>
                        <input type="email" disabled value="{{ current_user.email }}"
                            class="w-full px-4 py-3 rounded-md border border-secondaryLight bg-gray-50 text-gray-500">
                        <p class="text-xs text-secondary">電子郵件無法修改</p>
                    </div>

                    <div class="space-y-2">
                        <label class="text-sm font-medium text-secondaryDark">學號</label>
                        <input type="text" name="student_id" value="{{ current_user.student_id or '' }}"
                            class="w-full px-4 py-3 rounded-md border border-secondaryLight focus:ring-2 focus:ring-primary/60 focus:border-primary">
                    </div>

                    <div class="space-y-2">
                        <label class="text-sm font-medium text-secondaryDark">手機號碼</label>
                        <input type="tel" name="phone" value="{{ current_user.phone or '' }}" placeholder="0912345678"
                            class="w-full px-4 py-3 rounded-md border border-secondaryLight focus:ring-2 focus:ring-primary/60 focus:border-primary">
                    </div>

                    <div class="space-y-2">
                        <label class="text-sm font-medium text-secondaryDark">就讀學校</label>
                        <input type="text" name="school" value="{{ current_user.school or '' }}" placeholder="例：國立高雄科技大學"
                            class="w-full px-4 py-3 rounded-md border border-secondaryLight focus:ring-2 focus:ring-primary/60 focus:border-primary">
                    </div>

                    <div class="space-y-2">
                        <label class="text-sm font-medium text-secondaryDark">科系</label>
                        <input type="text" name="department" value="{{ current_user.department or '' }}"
                            placeholder="例：資訊管理系"
                            class="w-full px-4 py-3 rounded-md border border-secondaryLight focus:ring-2 focus:ring-primary/60 focus:border-primary">
                    </div>
                </div>

                <div class="flex justify-end gap-3 pt-4">
                    <button type="button" onclick="window.location.reload()"
                        class="px-5 py-2 rounded-lg border border-secondaryLight text-secondary hover:bg-gray-50">
                        取消
                    </button>
                    <button type="submit"
                        class="px-5 py-2 rounded-lg bg-primary text-white shadow-md hover:bg-primaryHover">
                        儲存變更
                    </button>
                </div>
            </form>
        </div>

        <!-- Change Password Form -->
        <div class="bg-white rounded-xl shadow-card p-6">
            <h2 class="text-lg font-semibold text-secondaryDark mb-4">變更密碼</h2>
            <form method="post" action="{{ url_for('auth.profile') }}" class="space-y-4">
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                <input type="hidden" name="action" value="change_password">

                <div class="space-y-2">
                    <label class="text-sm font-medium text-secondaryDark">目前密碼 *</label>
                    <input type="password" name="old_password" required
                        class="w-full px-4 py-3 rounded-md border border-secondaryLight focus:ring-2 focus:ring-primary/60 focus:border-primary">
                </div>

                <div class="space-y-2">
                    <label class="text-sm font-medium text-secondaryDark">新密碼 *</label>
                    <input type="password" name="new_password" required
                        class="w-full px-4 py-3 rounded-md border border-secondaryLight focus:ring-2 focus:ring-primary/60 focus:border-primary">
                    <p class="text-xs text-secondary">密碼至少需要 8 個字元，包含大小寫字母和數字</p>
                </div>

                <div class="space-y-2">
                    <label class="text-sm font-medium text-secondaryDark">確認新密碼 *</label>
                    <input type="password" name="confirm_password" required
                        class="w-full px-4 py-3 rounded-md border border-secondaryLight focus:ring-2 focus:ring-primary/60 focus:border-primary">
                </div>

                <div class="flex justify-end pt-4">
                    <button type="submit"
                        class="px-5 py-2 rounded-lg bg-primary text-white shadow-md hover:bg-primaryHover">
                        更新密碼
                    </button>
                </div>
            </form>
        </div>

        <!-- Account Info -->
        <div class="bg-white rounded-xl shadow-card p-6">
            <h2 class="text-lg font-semibold text-secondaryDark mb-4">帳戶資訊</h2>
            <div class="space-y-3 text-sm">
                <div class="flex justify-between py-2 border-b border-gray-100">
                    <span class="text-secondary">註冊時間</span>
                    <span class="text-secondaryDark font-medium">{{ current_user.created_at.strftime('%Y年%m月%d日')
                        }}</span>
                </div>
                {% if stats %}
                <div class="flex justify-between py-2 border-b border-gray-100">
                    <span class="text-secondary">上架商品數</span>
                    <span class="text-secondaryDark font-medium">{{ stats.active_products }} 項</span>
                </div>
                <div class="flex justify-between py-2">
                    <span class="text-secondary">完成交易數</span>
                    <span class="text-secondaryDark font-medium">{{ stats.completed_transactions }} 筆</span>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</section>
{% endblock %}